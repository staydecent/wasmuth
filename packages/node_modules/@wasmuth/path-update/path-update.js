import check from 'check-arg-types'

import pathGet from '@wasmuth/path'
import pathSet from '@wasmuth/path-set'
import merge from '@wasmuth/merge'
import partial from '@wasmuth/partial'

const toType = check.prototype.toType

export default function pathUpdate (path, value, state) {
  if (arguments.length < 3) return partial(pathSet, arguments)
  const currentValue = pathGet(path, state)
  const newType = toType(value)

  if (newType === toType(currentValue)) {
    if (newType === 'array') {
      return pathSet(path, currentValue.concat(value), state)
    } else if (newType === 'object') {
      return pathSet(path, merge(currentValue, value), state)
    }
  }
  return pathSet(path, value, state)
}
